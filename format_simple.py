#!/usr/bin/env python3
"""
ç®€åŒ–ç‰ˆæ ¼å¼åŒ–å·¥å…·ï¼Œä¸“é—¨ä¿®å¤æˆ‘ä»¬å‘ç°çš„é—´è·é—®é¢˜
"""
import re

def format_cpp_line(line):
    """æ ¼å¼åŒ–å•è¡ŒC++ä»£ç """
    # ä¿æŒç¼©è¿›
    indent = len(line) - len(line.lstrip())
    content = line.strip()
    
    if not content:
        return line
    
    # è¿ç®—ç¬¦é—´è·ä¿®å¤
    # ç²¾ç¡®åŒ¹é…å¸¸è§çš„é—®é¢˜æ¨¡å¼
    replacements = [
        # æ¯”è¾ƒè¿ç®—ç¬¦
        (r'([a-zA-Z0-9_\]\)])>=([a-zA-Z0-9_\[\(])', r'\1 >= \2'),
        (r'([a-zA-Z0-9_\]\)])<=([a-zA-Z0-9_\[\(])', r'\1 <= \2'),
        (r'([a-zA-Z0-9_\]\)])>(?![>=])([a-zA-Z0-9_\[\(])', r'\1 > \2'),
        (r'([a-zA-Z0-9_\]\)])<(?![<=])([a-zA-Z0-9_\[\(])', r'\1 < \2'),
        (r'([a-zA-Z0-9_\]\)])!=([a-zA-Z0-9_\[\(])', r'\1 != \2'),
        (r'([a-zA-Z0-9_\]\)])==([a-zA-Z0-9_\[\(])', r'\1 == \2'),
        
        # ä½è¿ç®—ç¬¦
        (r'([a-zA-Z0-9_\]\)])<<([a-zA-Z0-9_\[\(])', r'\1 << \2'),
        (r'([a-zA-Z0-9_\]\)])>>([a-zA-Z0-9_\[\(])', r'\1 >> \2'),
        (r'([a-zA-Z0-9_\]\)])&([a-zA-Z0-9_\[\(\-])', r'\1 & \2'),
        (r'([a-zA-Z0-9_\]\)])\|([a-zA-Z0-9_\[\(])', r'\1 | \2'),
        (r'([a-zA-Z0-9_\]\)])\^([a-zA-Z0-9_\[\(])', r'\1 ^ \2'),
        
        # ç®—æœ¯è¿ç®—ç¬¦
        (r'([a-zA-Z0-9_\]\)])\+([a-zA-Z0-9_\[\(])', r'\1 + \2'),
        (r'([a-zA-Z0-9_\]\)])-([a-zA-Z0-9_\[\(])', r'\1 - \2'),
        (r'([a-zA-Z0-9_\]\)])\*([a-zA-Z0-9_\[\(])', r'\1 * \2'),
        (r'([a-zA-Z0-9_\]\)])/([a-zA-Z0-9_\[\(])', r'\1 / \2'),
        (r'([a-zA-Z0-9_\]\)])%([a-zA-Z0-9_\[\(])', r'\1 % \2'),
        
        # èµ‹å€¼è¿ç®—ç¬¦
        (r'([a-zA-Z0-9_\]\)])\+=([a-zA-Z0-9_\[\(])', r'\1 += \2'),
        (r'([a-zA-Z0-9_\]\)])-=([a-zA-Z0-9_\[\(])', r'\1 -= \2'),
        (r'([a-zA-Z0-9_\]\)])\*=([a-zA-Z0-9_\[\(])', r'\1 *= \2'),
        (r'([a-zA-Z0-9_\]\)])/=([a-zA-Z0-9_\[\(])', r'\1 /= \2'),
        (r'([a-zA-Z0-9_\]\)])%=([a-zA-Z0-9_\[\(])', r'\1 %= \2'),
        (r'([a-zA-Z0-9_\]\)])\^=([a-zA-Z0-9_\[\(])', r'\1 ^= \2'),
        (r'([a-zA-Z0-9_\]\)])\|=([a-zA-Z0-9_\[\(])', r'\1 |= \2'),
        (r'([a-zA-Z0-9_\]\)])&=([a-zA-Z0-9_\[\(])', r'\1 &= \2'),
        (r'([a-zA-Z0-9_\]\)])=([^=])', r'\1 = \2'),
        
        # é€»è¾‘è¿ç®—ç¬¦
        (r'([a-zA-Z0-9_\]\)])&&([a-zA-Z0-9_\[\(])', r'\1 && \2'),
        (r'([a-zA-Z0-9_\]\)])\|\|([a-zA-Z0-9_\[\(])', r'\1 || \2'),
        
        # å…³é”®å­—
        (r'\b(if|for|while|switch)\(', r'\1 ('),
        (r'}else', '} else'),
        (r'else{', 'else {'),
        (r'(\w)\{', r'\1 {'),
        
        # é€—å·å’Œåˆ†å·
        (r',(\S)', r', \1'),
        (r';(\S)', r'; \1'),
        
        # æ¨¡æ¿ç®€åŒ– - å…ˆå¤„ç†å†…éƒ¨ç©ºæ ¼ï¼Œå†å¤„ç†å¤–éƒ¨ç©ºæ ¼
        (r'(\w+)\s*<\s*([^<>,]+)\s*>\s*', r'\1<\2> '),
        (r'(\w+)\s*<\s*([^<>,]+)\s*,\s*([^<>,]+)\s*>\s*', r'\1<\2, \3> '),
        # æ¸…ç†æ¨¡æ¿ç»“å°¾å¤šä½™ç©ºæ ¼ï¼ˆé™¤éåé¢æ˜¯å­—æ¯ï¼‰
        (r'>\s+(?![a-zA-Z_])', '>'),
        (r'>([a-zA-Z_])', r'> \1'),
        
        # æ¸…ç†
        (r'\(\s+', '('),
        (r'\s+\)', ')'),
        (r'  +', ' '),
    ]
    
    for pattern, replacement in replacements:
        content = re.sub(pattern, replacement, content)
    
    return ' ' * indent + content

def test_format():
    test_cases = [
        ("i>=0", "i >= 0"),
        ("hh<=tt", "hh <= tt"),
        ("N<<1", "N << 1"),
        ("l+r>>1", "l + r >> 1"),
        ("1<<i", "1 << i"),
        ("data[i]<cur", "data[i] < cur"),
        ("w[q[tt]]>=w[i]", "w[q[tt]] >= w[i]"),
        ("m^=1ULL", "m ^= 1ULL"),
        ("sz[py]+=sz[px]", "sz[py] += sz[px]"),
        ("i&-i", "i & -i"),
        ("vector < int > v;", "vector<int> v;"),
        ("map < string, int > mp;", "map<string, int> mp;"),
        ("if(condition)", "if (condition)"),
        ("for(int i=0;i<n;i++)", "for (int i = 0; i < n; i++)"),
        ("a+b*c", "a + b * c"),
        ("vector<int>v(n,0);", "vector<int> v(n, 0);"),
    ]
    
    print("æµ‹è¯•æ ¼å¼åŒ–è§„åˆ™...")
    failed = 0
    for input_str, expected in test_cases:
        result = format_cpp_line(input_str).strip()
        if result != expected:
            print(f"âŒ å¤±è´¥: '{input_str}' -> '{result}', æœŸæœ›: '{expected}'")
            failed += 1
        else:
            print(f"âœ… é€šè¿‡: '{input_str}' -> '{result}'")
    
    if failed == 0:
        print("ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡!")
    else:
        print(f"âŒ {failed} ä¸ªæµ‹è¯•å¤±è´¥")

if __name__ == '__main__':
    test_format()